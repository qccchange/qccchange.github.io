<!DOCTYPE html>
<html class="theme-next pisces use-motion">
<head>
  <title>qcc</title>
  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <meta name="theme-color" content="#222">
  <meta http-equiv="Cache-Control" content="no-transform"/>
  <meta http-equiv="Cache-Control" content="no-siteapp"/>
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>
  <link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"/>
  <link href="/css/pisces.css?v=5.1.4" rel="stylesheet" type="text/css"/>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">
  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">
  <meta name="description">
  <meta property="og:type" content="website">
  <meta property="og:title" content="qcc">
  <meta property="og:url">
  <meta property="og:site_name" content="qcc">
  <meta property="og:locale" content="zh_CN">
  <meta property="article:author" content="Docs4dev">
  <meta name="twitter:card">

  <script type="text/javascript" id="hexo.configurations">
    var scheme = "Pisces";
    var NexT = window.NexT || {};
    var CONFIG = {
      root: '/',
      scheme: scheme,
      version: '5.1.4',
      sidebar: {
        "position": "left",
        "display": "post",
        "offset": 12,
        "b2t": false,
        "scrollpercent": false,
        "onmobile": false
      },
      fancybox: true,
      tabs: true,
      motion: {
        "enable": true,
        "async": false,
        "transition": {
          "post_block": "fadeIn",
          "post_header": "slideDownIn",
          "post_body": "slideDownIn",
          "coll_header": "slideLeftIn",
          "sidebar": "slideUpIn"
        }
      },
    };
  </script>
  <link rel="canonical" href=""/>
  <meta name="generator" content="Docs4dev template engine">
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="en">
<div class="container sidebar-position-left page-home">
  <div class="headband"></div>
  
  <header id="header" class="header">
    <div class="header-inner">
      <div class="site-brand-wrapper">
        <div class="site-meta ">
          <div class="custom-logo-site-title">
            <a href="/" class="brand" rel="start">
              <span class="logo-line-before"><i></i></span>
              <span class="site-title">qcc</span>
              <span class="logo-line-after"><i></i></span>
            </a>
          </div>
          <p class="site-subtitle"></p>
        </div>

        <div class="site-nav-toggle">
          <button>
            <span class="btn-bar"></span>
            <span class="btn-bar"></span>
            <span class="btn-bar"></span>
          </button>
        </div>
      </div>

      <nav class="site-nav">
        <ul id="menu" class="menu">
          <li class="menu-item menu-item-home">
            <a href="/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br/>
              <span>首页</span>
            </a>
          </li>
          <li class="menu-item menu-item-archives">
            <a href="/archives" rel="section">
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br/>
              <span>归档</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </header>


  <main id="main" class="main">
    <div class="main-inner">
      <div class="content-wrap">
        <div id="content" class="content">
          <section id="posts" class="posts-expand">
            <article class="post post-type-normal">
              <div class="post-block">
                <header class="post-header">
                  <h1 class="post-title" itemprop="name headline">
                    <a class="post-title-link"
                       href="/posts/hiveudfkai-fa.html"
                       itemprop="url"
                    >hive udf 开发</a>
                  </h1>
                  <div class="post-meta">
                    <span class="post-time">
                      <span class="post-meta-item-icon">
                        <i class="fa fa-calendar-o"></i>
                      </span>
                      <span class="post-meta-item-text">Posted on</span>
                      <time title="Post created"
                            itemprop="dateCreated datePublished"
                            datetime="2020-08-11T13:23:05"
                      >2020-08-11T13:23:05</time>
                    </span>
                    
                  </div>
                </header>
                <div class="post-body" itemprop="articleBody">
                  <div><h3 id="maven环境搭建"><a href="#maven环境搭建" id="maven环境搭建"></a>maven环境搭建</h3>
<p>1.下载maven</p>
<blockquote>
<p>ps：不要下载最新版，下载3.5.4，不然会遇到unable to import maven project，具体原因不明</p>
</blockquote>
<p>2.配置全局变量</p>
<pre><code class="hljs language-shell">
vim ~/.bash_profile

# 写入

export MAVEN_HOME=/Users/qiuchencheng/softwares/apache-maven-3.5.4

export PATH=$PATH:$MAVEN_HOME/bin

# 更新环境变量配置

source ~/.bash_profile

</code></pre>
<p>测试语句</p>
<p><code>mvn -v</code></p>
<pre><code class="hljs language-shell">
C02CQ64GMD6M:~ qiuchencheng$ mvn -v

Apache Maven 3.5.4 (1edded0938998edf8bf061f1ceb3cfdeccf443fe; 2018-06-18T02:33:14+08:00)

Maven home: /Users/qiuchencheng/softwares/apache-maven-3.5.4-bytedance

Java version: 1.8.0_231, vendor: Oracle Corporation, runtime: /Library/Java/JavaVirtualMachines/jdk1.8.0_231.jdk/Contents/Home/jre

Default locale: zh_CN, platform encoding: UTF-8

OS name: &quot;mac os x&quot;, version: &quot;10.15.6&quot;, arch: &quot;x86_64&quot;, family: &quot;mac&quot;

</code></pre>
<p>配置仓库</p>
<p>首先配置公司maven私服：https://bytedance.feishu.cn/docs/doccnH7EajrfbmJEkW8DAoi3qPb#</p>
<pre><code class="hljs language-shell">
wget -qO - http://maven.byted.org/assets/install_settings.sh | bash -s

</code></pre>
<p>通过上述链接，将字节的私服setting.xml文件代替原本<code>apache-maven-3.5.4/conf</code>目录下的setting.xml文件</p>
<p>Maven很像一个很大仓库，装了很多的jar包，我们需要的时候就去拿，这就涉及到一个“本地仓库”的问题，默认情况，会在/user/name/.m2下，所以我们需要去更改一下，自定义本地仓库目录，在setting.xml中添加</p>
<p><code>&lt;localRepository&gt;/Users/qiuchencheng/softwares/apache-maven-3.5.4-bytedance/repo&lt;/localRepository&gt;</code></p>
<p>中央仓库下载文件到本地库</p>
<p><code>mvn help:system</code></p>
<h3 id="配置idea"><a href="#配置idea" id="配置idea"></a>配置IDEA</h3>
<p>首先设置</p>
<p><img src="evernotecid://81E3FAE3-C243-45E2-B7C8-62F78A44F108/appyinxiangcom/30274574/ENResource/p1" alt="6112f2bbcaf9f4040959ce0439836f6f.png" /></p>
<p>然后新建一个project</p>
<p><img src="evernotecid://81E3FAE3-C243-45E2-B7C8-62F78A44F108/appyinxiangcom/30274574/ENResource/p2" alt="7d3831b6d93f8b2c3554103c69e8f926.png" /></p>
<p>GroupId和Artifactld自定义填写即可</p>
<h3 id="测试udf"><a href="#测试udf" id="测试udf"></a>测试udf</h3>
<p>pom.xml设置如下</p>
<pre><code class="hljs language-shell">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;

xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;

xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;

&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

&lt;groupId&gt;com.bytedance.qcc.udf&lt;/groupId&gt;

&lt;artifactId&gt;bytedance_udf_test&lt;/artifactId&gt;

&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

&lt;!-- 部署到私服 --&gt;

&lt;distributionManagement&gt;

&lt;repository&gt;

&lt;id&gt;bytedance-releases&lt;/id&gt;

&lt;url&gt;http://maven.byted.org/repository/releases&lt;/url&gt;

&lt;/repository&gt;

&lt;snapshotRepository&gt;

&lt;id&gt;bytedance-snapshots&lt;/id&gt;

&lt;url&gt;http://maven.byted.org/repository/snapshots&lt;/url&gt;

&lt;/snapshotRepository&gt;

&lt;/distributionManagement&gt;

&lt;!-- 从私服拉取依赖 --&gt;

&lt;repositories&gt;

&lt;repository&gt;

&lt;id&gt;bytedance-snapshots&lt;/id&gt;

&lt;url&gt;http://maven.byted.org/repository/snapshots&lt;/url&gt;

&lt;/repository&gt;

&lt;repository&gt;

&lt;id&gt;bytedance-releases&lt;/id&gt;

&lt;url&gt;http://maven.byted.org/repository/releases&lt;/url&gt;

&lt;/repository&gt;

&lt;repository&gt;

&lt;id&gt;cloudera&lt;/id&gt;

&lt;url&gt;http://repository.cloudera.com/artifactory/cloudera-repos&lt;/url&gt;

&lt;/repository&gt;

&lt;/repositories&gt;

&lt;!-- 从私服拉取plugin --&gt;

&lt;pluginRepositories&gt;

&lt;pluginRepository&gt;

&lt;id&gt;bytedance-releases&lt;/id&gt;

&lt;url&gt;https://maven.byted.org/repository/releases&lt;/url&gt;

&lt;/pluginRepository&gt;

&lt;pluginRepository&gt;

&lt;id&gt;bytedance-snapshots&lt;/id&gt;

&lt;url&gt;https://maven.byted.org/repository/snapshots&lt;/url&gt;

&lt;/pluginRepository&gt;

&lt;/pluginRepositories&gt;

&lt;!-- 根据要连接的hadoop和hive，设置版本参数 --&gt;

&lt;properties&gt;

&lt;hadoop.version&gt;2.6.0-cdh5.7.1&lt;/hadoop.version&gt;

&lt;hive.version&gt;1.1.0-cdh5.7.1&lt;/hive.version&gt;

&lt;/properties&gt;

&lt;!-- 因为使用CDH的hadoop和hive，因此要添加CDH的官方repository，才能够下载相应的依赖包 --&gt;

&lt;!-- 如果使用Apache版本的hadoop和hive，则不需要添加该repository --&gt;

&lt;dependencies&gt;

&lt;!-- 添加依赖组件，根据上方配置的版本参数和repository知识库下载依赖 --&gt;

&lt;dependency&gt;

&lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;

&lt;artifactId&gt;hadoop-common&lt;/artifactId&gt;

&lt;version&gt;${hadoop.version}&lt;/version&gt;

&lt;/dependency&gt;

&lt;dependency&gt;

&lt;groupId&gt;org.apache.hive&lt;/groupId&gt;

&lt;artifactId&gt;hive-exec&lt;/artifactId&gt;

&lt;version&gt;${hive.version}&lt;/version&gt;

&lt;/dependency&gt;

&lt;!-- junit是java的单元测试框架 --&gt;

&lt;dependency&gt;

&lt;groupId&gt;junit&lt;/groupId&gt;

&lt;artifactId&gt;junit&lt;/artifactId&gt;

&lt;version&gt;4.10&lt;/version&gt;

&lt;scope&gt;test&lt;/scope&gt;

&lt;/dependency&gt;

&lt;/dependencies&gt;

&lt;/project&gt;

</code></pre>
<p>然后编写测试udf函数</p>
<p><img src="evernotecid://81E3FAE3-C243-45E2-B7C8-62F78A44F108/appyinxiangcom/30274574/ENResource/p3" alt="a38446fc6a0fc5fa402901464bf22732.png" /></p>
<p>测试无误后输出jar文件</p>
<p><img src="evernotecid://81E3FAE3-C243-45E2-B7C8-62F78A44F108/appyinxiangcom/30274574/ENResource/p4" alt="83944e17cb8eb325f9c812d3662b466e.png" /></p>
<p>然后将jar文件put到开发机</p>
<p>接下来开发机需要将jar文件上传到线上hdfs，因此需要看自己是否在BOE环境，在boe的话无法连接线上的，具体可看：<a href="https://bytedance.feishu.cn/wiki/wikcnK0OV7a6EA4DD8yj4jc5s6d">https://bytedance.feishu.cn/wiki/wikcnK0OV7a6EA4DD8yj4jc5s6d</a></p>
<p><code>hadoop fs -put bytedance_udf_test.jar hdfs://haruna/user/tiger/qiuchencheng</code></p>
<p>接下来就可以在风神用函数查询啦~</p>
<pre><code class="hljs language-shell">
CREATE TEMPORARY FUNCTION test AS 'udf_test' using jar 'hdfs://haruna/user/tiger/qiuchencheng/bytedance_udf_test.jar';

SELECT test(&quot;a json string&quot;);

</code></pre>
<p>输出</p>
<pre><code class="hljs language-shell">
test(a json string)

a json string_udf_processed

</code></pre>
<blockquote>
<p>参考：</p>
</blockquote>
<p><a href="https://bytedance.feishu.cn/docs/LmWaUeefsxfppK0sspkQZe#">https://bytedance.feishu.cn/docs/LmWaUeefsxfppK0sspkQZe#</a></p>
<blockquote>
<p><a href="https://blog.csdn.net/b_aihe/article/details/91382918">https://blog.csdn.net/b_aihe/article/details/91382918</a></p>
</blockquote>
<blockquote>
<p><a href="https://blog.csdn.net/sheep8521/article/details/81001893">https://blog.csdn.net/sheep8521/article/details/81001893</a></p>
</blockquote>
</div>
                  <!--noindex-->
                  <div class="post-button text-center">
                    <a class="btn" href="/posts/hiveudfkai-fa.html" rel="contents">
                      Read more &raquo;
                    </a>
                  </div>
                  <!--/noindex-->
                </div>
                <footer class="post-footer">
                  <div class="post-eof"></div>
                </footer>
              </div>
            </article>
          </section>
          
  

        </div>
      </div>
      
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>
  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
      
  <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
    <div class="site-overview">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <img class="site-author-image"
             itemprop="image"
             src="/images/avatar.gif"
             alt="avatar"/>
        <p class="site-author-name" itemprop="name">Docs4dev</p>
        <p class="site-description motion-element" itemprop="description"></p>
      </div>
      <nav class="site-state motion-element">
        <div class="site-state-item site-state-posts">
          <a href="/archives">
            <span class="site-state-item-count">1</span>
            <span class="site-state-item-name">文章</span>
          </a>
        </div>
        <div class="site-state-item site-state-categories">
          <span class="site-state-item-count">1</span>
          <span class="site-state-item-name">分类</span>
        </div>
        <div class="site-state-item site-state-tags">
          <span class="site-state-item-count">0</span>
          <span class="site-state-item-name">标签</span>
        </div>
      </nav>
    </div>
  </section>

    </div>
  </aside>

    </div>
  </main>

  
  <footer id="footer" class="footer">
    <div class="footer-inner">
      <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
        <span class="with-love">
          <i class="fa fa-user"></i>
        </span>
        <span class="author" itemprop="copyrightHolder">Docs4dev</span>
      </div>
      <div class="powered-by">Powered by <a class="theme-link" target="_blank"
                                            href="https://www.docs4dev.com">Docs4dev</a></div>
      <span class="post-meta-divider">|</span>
      <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank"
                                               href="https://github.com/docs4dev/theme-next">NexT</a> v5.1.4
      </div>
    </div>
  </footer>

  
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
  </div>

</div>

  <script type="text/javascript">
    if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
      window.Promise = null;
    }
  </script>
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>

</body>
</html>
